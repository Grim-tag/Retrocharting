(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[29],{81631:(e,t,r)=>{Promise.resolve().then(r.bind(r,55297))},80022:(e,t,r)=>{"use strict";r.d(t,{G_:()=>n,j:()=>s});var a=r(12115);let o=(0,a.createContext)(null);function n(e){let{clientId:t,nonce:r,onScriptLoadSuccess:n,onScriptLoadError:l,children:s}=e,i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{nonce:t,onScriptLoadSuccess:r,onScriptLoadError:o}=e,[n,l]=(0,a.useState)(!1),s=(0,a.useRef)(r);s.current=r;let i=(0,a.useRef)(o);return i.current=o,(0,a.useEffect)(()=>{let e=document.createElement("script");return e.src="https://accounts.google.com/gsi/client",e.async=!0,e.defer=!0,e.nonce=t,e.onload=()=>{var e;l(!0),null===(e=s.current)||void 0===e||e.call(s)},e.onerror=()=>{var e;l(!1),null===(e=i.current)||void 0===e||e.call(i)},document.body.appendChild(e),()=>{document.body.removeChild(e)}},[t]),n}({nonce:r,onScriptLoadSuccess:n,onScriptLoadError:l}),c=(0,a.useMemo)(()=>({clientId:t,scriptLoadedSuccessfully:i}),[t,i]);return a.createElement(o.Provider,{value:c},s)}let l={large:40,medium:32,small:20};function s(e){let{onSuccess:t,onError:r,useOneTap:n,promptMomentNotification:s,type:i="standard",theme:c="outline",size:d="large",text:u,shape:h,logo_alignment:m,width:f,locale:p,click_listener:g,containerProps:x,...v}=e,y=(0,a.useRef)(null),{clientId:b,scriptLoadedSuccessfully:w}=function(){let e=(0,a.useContext)(o);if(!e)throw Error("Google OAuth components must be used within GoogleOAuthProvider");return e}(),j=(0,a.useRef)(t);j.current=t;let N=(0,a.useRef)(r);N.current=r;let C=(0,a.useRef)(s);return C.current=s,(0,a.useEffect)(()=>{var e,t,r,a,o,l,s,x,_;if(w)return null===(r=null===(t=null===(e=null==window?void 0:window.google)||void 0===e?void 0:e.accounts)||void 0===t?void 0:t.id)||void 0===r||r.initialize({client_id:b,callback:e=>{var t,r;if(!(null==e?void 0:e.credential))return null===(t=N.current)||void 0===t?void 0:t.call(N);let{credential:a,select_by:o}=e;j.current({credential:a,clientId:null!==(r=null==e?void 0:e.clientId)&&void 0!==r?r:null==e?void 0:e.client_id,select_by:o})},...v}),null===(l=null===(o=null===(a=null==window?void 0:window.google)||void 0===a?void 0:a.accounts)||void 0===o?void 0:o.id)||void 0===l||l.renderButton(y.current,{type:i,theme:c,size:d,text:u,shape:h,logo_alignment:m,width:f,locale:p,click_listener:g}),n&&(null===(_=null===(x=null===(s=null==window?void 0:window.google)||void 0===s?void 0:s.accounts)||void 0===x?void 0:x.id)||void 0===_||_.prompt(C.current)),()=>{var e,t,r;n&&(null===(r=null===(t=null===(e=null==window?void 0:window.google)||void 0===e?void 0:e.accounts)||void 0===t?void 0:t.id)||void 0===r||r.cancel())}},[b,w,n,i,c,d,u,h,m,f,p]),a.createElement("div",{...x,ref:y,style:{height:l[d],...null==x?void 0:x.style}})}},76046:(e,t,r)=>{"use strict";var a=r(66658);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},55297:(e,t,r)=>{"use strict";r.d(t,{default:()=>c});var a=r(95155),o=r(12115),n=r(76046),l=r(68435),s=r(85534);let i="".concat((0,s.e9)(),"/api/v1");function c(e){let{lang:t}=e,r=(0,n.useRouter)(),{token:c}=(0,l.A)(),[u,h]=(0,o.useState)(1),[m,f]=(0,o.useState)(null),[p,g]=(0,o.useState)(!1),[x,v]=(0,o.useState)(!1),[y,b]=(0,o.useState)(null),w=async()=>{if(y&&c){v(!0);try{let e=y.matches.map(e=>({product_id:e.match.id,condition:e.item.condition,paid_price:e.item.paid_price?parseFloat(e.item.paid_price):void 0,currency:e.item.currency,purchase_date:e.item.purchase_date,comment:e.item.comment})),a=await (0,s.Go)(e,c);alert("Success! Imported ".concat(a.imported," items.")),r.push("/".concat(t,"/collection"))}catch(e){console.error(e),alert("Import failed. Please try again.")}finally{v(!1)}}},j=async()=>{if(m&&c){g(!0);try{let e=await (0,s.CG)(m,c);e&&(b(e),h(3))}catch(e){console.error(e),alert("Analysis failed. Please check your CSV format.")}finally{g(!1)}}};return(0,a.jsx)("div",{className:"min-h-screen bg-[#0f121e] text-white p-8",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsxs)("header",{className:"mb-8 flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Import Collection (CSV)"}),(0,a.jsx)("button",{onClick:()=>r.push("/".concat(t,"/collection")),className:"text-gray-400 hover:text-white",children:"← Back to Collection"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[(0,a.jsxs)("div",{className:"col-span-1 space-y-4",children:[(0,a.jsx)(d,{current:u,step:1,title:"Download Template"}),(0,a.jsx)(d,{current:u,step:2,title:"Upload CSV"}),(0,a.jsx)(d,{current:u,step:3,title:"Review Matches"})]}),(0,a.jsxs)("div",{className:"col-span-3 bg-[#1f2533] p-8 rounded-xl border border-[#2a3142]",children:[1===u&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-[#ff6600]",children:"Step 1: Get the Template"}),(0,a.jsx)("p",{className:"text-gray-300",children:"To ensure your collection is imported correctly, please use our official CSV template. Fill it with your games data."}),(0,a.jsxs)("div",{className:"bg-[#2a3142] p-4 rounded text-sm text-gray-300 font-mono",children:["Required Columns: Title, Platform",(0,a.jsx)("br",{}),"Optional: Condition, Paid Price, Currency, Notes"]}),(0,a.jsxs)("button",{onClick:()=>{window.open("".concat(i,"/import/template"),"_blank")},className:"w-full py-3 bg-[#ff6600] hover:bg-[#ff7b24] text-white font-bold rounded-lg transition-colors flex items-center justify-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download CSV Template"]}),(0,a.jsx)("div",{className:"pt-4 border-t border-[#2a3142]",children:(0,a.jsx)("button",{onClick:()=>h(2),className:"w-full py-2 bg-gray-600 hover:bg-gray-500 text-white font-medium rounded transition-colors",children:"I have my CSV ready →"})})]}),2===u&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-[#ff6600]",children:"Step 2: Upload CSV"}),(0,a.jsx)("p",{className:"text-gray-300",children:"Upload your filled CSV file here. We will analyze it and try to match your games with our database."}),(0,a.jsxs)("label",{className:"block border-2 border-dashed border-gray-600 rounded-lg p-12 text-center hover:border-[#ff6600] transition-colors cursor-pointer bg-[#1f2533]/50",children:[(0,a.jsx)("input",{type:"file",className:"hidden",accept:".csv",onChange:e=>{e.target.files&&e.target.files[0]&&f(e.target.files[0])}}),(0,a.jsx)("div",{className:"text-gray-400",children:m?(0,a.jsx)("div",{className:"text-[#ff6600] font-bold text-lg",children:m.name}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{children:"Drag & Drop your CSV file here"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"or click to browse"})]})})]}),(0,a.jsxs)("div",{className:"pt-4 flex gap-4",children:[(0,a.jsx)("button",{onClick:()=>h(1),className:"flex-1 py-2 bg-transparent border border-gray-600 text-gray-300 hover:text-white rounded transition-colors",children:"← Back"}),(0,a.jsx)("button",{onClick:j,disabled:!m||p,className:"flex-1 py-2 font-bold rounded transition-colors ".concat(!m||p?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-[#ff6600] hover:bg-[#ff7b24] text-white"),children:p?(0,a.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Analyzing..."]}):"Analyze File"})]})]}),3===u&&y&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-green-500",children:"Step 3: Review Matches"}),(0,a.jsxs)("p",{className:"text-gray-300",children:["We found ",(0,a.jsx)("b",{children:y.matches.length})," matches and ",(0,a.jsx)("b",{children:y.ambiguous.length+y.unmatched.length})," needing attention."]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-[#2a3142]/50 p-4 rounded border border-[#2a3142]",children:[(0,a.jsxs)("h3",{className:"font-bold text-green-400 mb-2",children:["✅ Confirmed Matches (",y.matches.length,")"]}),(0,a.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-2",children:y.matches.map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm p-2 bg-[#1f2533] rounded",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-white font-medium",children:e.item.title}),(0,a.jsxs)("span",{className:"text-gray-500 text-xs ml-2",children:["(",e.item.platform,")"]})]}),(0,a.jsx)("span",{className:"text-green-500 text-xs font-mono",children:"100% Match"})]},t))})]}),(y.ambiguous.length>0||y.unmatched.length>0)&&(0,a.jsxs)("div",{className:"bg-[#2a3142]/50 p-4 rounded border border-[#ff6600]/30",children:[(0,a.jsxs)("h3",{className:"font-bold text-[#ff6600] mb-2",children:["⚠️ Review Required (",y.ambiguous.length+y.unmatched.length,")"]}),(0,a.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-2",children:[...y.ambiguous,...y.unmatched].map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm p-2 bg-[#1f2533] rounded",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white font-medium",children:e.item.title}),(0,a.jsx)("div",{className:"text-gray-500 text-xs",children:e.item.platform})]}),(0,a.jsx)("div",{className:"text-right",children:e.match?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"text-[#ff6600] text-xs",children:["Best Guess: ",e.match.product_name]}),(0,a.jsxs)("div",{className:"text-gray-600 text-xs",children:[e.match.score,"% confidence"]})]}):(0,a.jsx)("span",{className:"text-red-500 text-xs font-mono",children:"No Match"})})]},t))})]})]}),(0,a.jsxs)("div",{className:"pt-4 flex gap-4",children:[(0,a.jsx)("button",{onClick:()=>h(2),className:"flex-1 py-2 bg-transparent border border-gray-600 text-gray-300 hover:text-white rounded transition-colors",children:"← Start Over"}),(0,a.jsx)("button",{onClick:w,disabled:x,className:"flex-1 py-2 font-bold rounded transition-colors ".concat(x?"bg-green-800 text-gray-300 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"),children:x?"Importing...":"Import ".concat(y.matches.length," Items")})]})]})]})]})]})})}function d(e){let{step:t,current:r,title:o}=e,n=t===r,l=t<r;return(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg transition-colors ".concat(n?"bg-[#1f2533] border border-[#ff6600]":"opacity-50"),children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm\n                ".concat(n?"bg-[#ff6600] text-white":l?"bg-green-500 text-white":"bg-gray-700 text-gray-300","\n            "),children:l?"✓":t}),(0,a.jsx)("span",{className:"font-medium ".concat(n?"text-white":"text-gray-400"),children:o})]})}},68435:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,AuthProvider:()=>i});var a=r(95155),o=r(12115),n=r(80022),l=r(85534);let s=(0,o.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,o.useState)(null),[c,d]=(0,o.useState)(null),[u,h]=(0,o.useState)(!0);(0,o.useEffect)(()=>{let e=localStorage.getItem("rc_token");e?(d(e),(0,l.Ni)(e).then(e=>{e?i(e):f()}).finally(()=>h(!1))):h(!1)},[]);let m=async e=>{let t=await (0,l.XL)(e);t&&t.access_token&&(localStorage.setItem("rc_token",t.access_token),d(t.access_token),i(await (0,l.Ni)(t.access_token)))},f=()=>{localStorage.removeItem("rc_token"),d(null),i(null)},p="dummy-client-id-for-static-build";p||console.error("CRITICAL: NEXT_PUBLIC_GOOGLE_CLIENT_ID is missing. Google Login will fail.");let g=async()=>{c&&i(await (0,l.Ni)(c))};return(0,a.jsx)(n.G_,{clientId:p,children:(0,a.jsx)(s.Provider,{value:{user:r,token:c,login:m,logout:f,refreshUser:g,isAuthenticated:!!r,loading:u},children:t})})}function c(){let e=(0,o.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},85534:(e,t,r)=>{"use strict";r.d(t,{$_:()=>y,CG:()=>j,Go:()=>N,Li:()=>f,Ni:()=>u,R1:()=>n,Ri:()=>l,Sb:()=>p,Sk:()=>c,Sz:()=>i,TK:()=>g,UQ:()=>s,XL:()=>d,X_:()=>h,bC:()=>x,e9:()=>o,fA:()=>w,jg:()=>v,mQ:()=>b,nL:()=>m});var a=r(93681);function o(){return a.H}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6?arguments[6]:void 0;try{return(await a.u.get("/products",{params:{console:e,limit:t,genre:r,type:o,sort:n,skip:l,search:s}})).data}catch(e){return console.error("Error fetching products:",e),[]}}async function l(e){try{return(await a.u.get("/products/search/grouped",{params:{query:e}})).data}catch(e){return console.error("Error searching products grouped:",e),{}}}async function s(e){try{let t=await a.u.get("/products/".concat(e,"/listings"),{params:{_t:new Date().getTime()}}),r="true"===t.headers["x-is-stale"];return{data:t.data,isStale:r,status:t.status}}catch(e){var t;return{data:[],isStale:!1,status:(null===(t=e.response)||void 0===t?void 0:t.status)||500}}}async function i(e){try{return(await a.u.get("/products/".concat(e,"/related"))).data}catch(e){return console.error("Error fetching related products:",e),[]}}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0;try{return(await a.u.get("/games/",{params:{console:e,limit:t,genre:r,type:s,sort:o,skip:n,search:l}})).data}catch(e){return console.error("Error fetching games:",e),[]}}async function d(e){try{return(await a.u.post("/auth/google",{credential:e})).data}catch(e){var t,r;throw console.error("Google Login failed",e),Error((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.detail)||e.message||"Login failed")}}async function u(e){try{return(await a.u.get("/auth/me")).data}catch(e){return null}}async function h(e){try{return(await a.u.get("/collection/")).data}catch(e){return console.error("Failed to fetch collection",e),[]}}async function m(e,t,r,o,n){try{return(await a.u.post("/collection/",{product_id:t,condition:r,paid_price:n,notes:o})).data}catch(e){var l,s;throw console.error("Failed to add to collection",e),Error((null===(s=e.response)||void 0===s?void 0:null===(l=s.data)||void 0===l?void 0:l.detail)||"Failed to add to collection")}}async function f(e,t,r){try{return(await a.u.put("/collection/".concat(t),r)).data}catch(e){var o,n;throw console.error("Failed to update collection item",e),Error((null===(n=e.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.detail)||"Failed to update item")}}async function p(e,t){try{return await a.u.delete("/collection/".concat(t)),!0}catch(e){return console.error("Failed to delete item",e),!1}}async function g(e,t){try{return(await a.u.put("/auth/me",t)).data}catch(e){throw e}}async function x(e){try{return(await a.u.get("/portfolio/summary")).data}catch(e){return console.error("Failed to fetch portfolio summary",e),{total_value:0,item_count:0,console_count:0,top_items:[]}}}async function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{return(await a.u.get("/portfolio/history",{params:{range_days:t}})).data}catch(e){return console.error("Failed to fetch portfolio history",e),[]}}async function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{return(await a.u.get("/portfolio/movers",{params:{days:t}})).data}catch(e){return console.error("Failed to fetch portfolio movers",e),{gainers:[],losers:[]}}}async function b(e){try{return(await a.u.get("/portfolio/debug")).data}catch(e){return console.error("Failed to fetch portfolio debug",e),{error:"Failed to fetch debug info"}}}async function w(e){try{return(await a.u.get("/portfolio/dashboard")).data}catch(e){return console.error("Failed to fetch portfolio dashboard",e),null}}async function j(e,t){let r=new FormData;r.append("file",e);try{return(await a.u.post("/import/upload",r,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(e){var o,n;throw console.error("CSV upload failed",e),Error((null===(n=e.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.detail)||"Upload failed")}}async function N(e,t){try{return(await a.u.post("/import/confirm",{items:e})).data}catch(e){var r,o;throw console.error("Bulk import failed",e),Error((null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.detail)||"Import failed")}}},93681:(e,t,r)=>{"use strict";r.d(t,{H:()=>o,u:()=>n});var a=r(82651);let o="".concat("http://127.0.0.1:8000","/api/v1"),n=a.A.create({baseURL:o,timeout:12e4,headers:{"Content-Type":"application/json"}});n.interceptors.request.use(e=>{{let t=localStorage.getItem("rc_token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),n.interceptors.response.use(e=>e,e=>Promise.reject(e))}},e=>{var t=t=>e(e.s=t);e.O(0,[651,441,517,358],()=>t(81631)),_N_E=e.O()}]);