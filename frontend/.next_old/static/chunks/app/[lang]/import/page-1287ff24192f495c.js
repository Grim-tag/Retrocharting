(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[29],{52637:(e,t,r)=>{Promise.resolve().then(r.bind(r,70018))},80022:(e,t,r)=>{"use strict";r.d(t,{G_:()=>n,j:()=>l});var a=r(12115);let o=(0,a.createContext)(null);function n(e){let{clientId:t,nonce:r,onScriptLoadSuccess:n,onScriptLoadError:s,children:l}=e,c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{nonce:t,onScriptLoadSuccess:r,onScriptLoadError:o}=e,[n,s]=(0,a.useState)(!1),l=(0,a.useRef)(r);l.current=r;let c=(0,a.useRef)(o);return c.current=o,(0,a.useEffect)(()=>{let e=document.createElement("script");return e.src="https://accounts.google.com/gsi/client",e.async=!0,e.defer=!0,e.nonce=t,e.onload=()=>{var e;s(!0),null===(e=l.current)||void 0===e||e.call(l)},e.onerror=()=>{var e;s(!1),null===(e=c.current)||void 0===e||e.call(c)},document.body.appendChild(e),()=>{document.body.removeChild(e)}},[t]),n}({nonce:r,onScriptLoadSuccess:n,onScriptLoadError:s}),i=(0,a.useMemo)(()=>({clientId:t,scriptLoadedSuccessfully:c}),[t,c]);return a.createElement(o.Provider,{value:i},l)}let s={large:40,medium:32,small:20};function l(e){let{onSuccess:t,onError:r,useOneTap:n,promptMomentNotification:l,type:c="standard",theme:i="outline",size:d="large",text:u,shape:h,logo_alignment:m,width:f,locale:p,click_listener:x,containerProps:g,...v}=e,y=(0,a.useRef)(null),{clientId:w,scriptLoadedSuccessfully:b}=function(){let e=(0,a.useContext)(o);if(!e)throw Error("Google OAuth components must be used within GoogleOAuthProvider");return e}(),j=(0,a.useRef)(t);j.current=t;let N=(0,a.useRef)(r);N.current=r;let _=(0,a.useRef)(l);return _.current=l,(0,a.useEffect)(()=>{var e,t,r,a,o,s,l,g,C;if(b)return null===(r=null===(t=null===(e=null==window?void 0:window.google)||void 0===e?void 0:e.accounts)||void 0===t?void 0:t.id)||void 0===r||r.initialize({client_id:w,callback:e=>{var t,r;if(!(null==e?void 0:e.credential))return null===(t=N.current)||void 0===t?void 0:t.call(N);let{credential:a,select_by:o}=e;j.current({credential:a,clientId:null!==(r=null==e?void 0:e.clientId)&&void 0!==r?r:null==e?void 0:e.client_id,select_by:o})},...v}),null===(s=null===(o=null===(a=null==window?void 0:window.google)||void 0===a?void 0:a.accounts)||void 0===o?void 0:o.id)||void 0===s||s.renderButton(y.current,{type:c,theme:i,size:d,text:u,shape:h,logo_alignment:m,width:f,locale:p,click_listener:x}),n&&(null===(C=null===(g=null===(l=null==window?void 0:window.google)||void 0===l?void 0:l.accounts)||void 0===g?void 0:g.id)||void 0===C||C.prompt(_.current)),()=>{var e,t,r;n&&(null===(r=null===(t=null===(e=null==window?void 0:window.google)||void 0===e?void 0:e.accounts)||void 0===t?void 0:t.id)||void 0===r||r.cancel())}},[w,b,n,c,i,d,u,h,m,f,p]),a.createElement("div",{...g,ref:y,style:{height:s[d],...null==g?void 0:g.style}})}},76046:(e,t,r)=>{"use strict";var a=r(66658);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},70018:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var a=r(95155),o=r(12115),n=r(76046),s=r(68435),l=r(85534);let c="".concat((0,l.e9)(),"/api/v1");function i(e){let{params:t}=e,{lang:r}=t,i=(0,n.useRouter)(),{token:u}=(0,s.A)(),[h,m]=(0,o.useState)(1),[f,p]=(0,o.useState)(null),[x,g]=(0,o.useState)(!1),[v,y]=(0,o.useState)(!1),[w,b]=(0,o.useState)(null),j=async()=>{if(w&&u){y(!0);try{let e=w.matches.map(e=>({product_id:e.match.id,condition:e.item.condition,paid_price:e.item.paid_price?parseFloat(e.item.paid_price):void 0,currency:e.item.currency,purchase_date:e.item.purchase_date,comment:e.item.comment})),t=await (0,l.Go)(e,u);alert("Success! Imported ".concat(t.imported," items.")),i.push("/".concat(r,"/collection"))}catch(e){console.error(e),alert("Import failed. Please try again.")}finally{y(!1)}}},N=async()=>{if(f&&u){g(!0);try{let e=await (0,l.CG)(f,u);e&&(b(e),m(3))}catch(e){console.error(e),alert("Analysis failed. Please check your CSV format.")}finally{g(!1)}}};return(0,a.jsx)("div",{className:"min-h-screen bg-[#0f121e] text-white p-8",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsxs)("header",{className:"mb-8 flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Import Collection (CSV)"}),(0,a.jsx)("button",{onClick:()=>i.push("/".concat(r,"/collection")),className:"text-gray-400 hover:text-white",children:"← Back to Collection"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[(0,a.jsxs)("div",{className:"col-span-1 space-y-4",children:[(0,a.jsx)(d,{current:h,step:1,title:"Download Template"}),(0,a.jsx)(d,{current:h,step:2,title:"Upload CSV"}),(0,a.jsx)(d,{current:h,step:3,title:"Review Matches"})]}),(0,a.jsxs)("div",{className:"col-span-3 bg-[#1f2533] p-8 rounded-xl border border-[#2a3142]",children:[1===h&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-[#ff6600]",children:"Step 1: Get the Template"}),(0,a.jsx)("p",{className:"text-gray-300",children:"To ensure your collection is imported correctly, please use our official CSV template. Fill it with your games data."}),(0,a.jsxs)("div",{className:"bg-[#2a3142] p-4 rounded text-sm text-gray-300 font-mono",children:["Required Columns: Title, Platform",(0,a.jsx)("br",{}),"Optional: Condition, Paid Price, Currency, Notes"]}),(0,a.jsxs)("button",{onClick:()=>{window.open("".concat(c,"/import/template"),"_blank")},className:"w-full py-3 bg-[#ff6600] hover:bg-[#ff7b24] text-white font-bold rounded-lg transition-colors flex items-center justify-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download CSV Template"]}),(0,a.jsx)("div",{className:"pt-4 border-t border-[#2a3142]",children:(0,a.jsx)("button",{onClick:()=>m(2),className:"w-full py-2 bg-gray-600 hover:bg-gray-500 text-white font-medium rounded transition-colors",children:"I have my CSV ready →"})})]}),2===h&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-[#ff6600]",children:"Step 2: Upload CSV"}),(0,a.jsx)("p",{className:"text-gray-300",children:"Upload your filled CSV file here. We will analyze it and try to match your games with our database."}),(0,a.jsxs)("label",{className:"block border-2 border-dashed border-gray-600 rounded-lg p-12 text-center hover:border-[#ff6600] transition-colors cursor-pointer bg-[#1f2533]/50",children:[(0,a.jsx)("input",{type:"file",className:"hidden",accept:".csv",onChange:e=>{e.target.files&&e.target.files[0]&&p(e.target.files[0])}}),(0,a.jsx)("div",{className:"text-gray-400",children:f?(0,a.jsx)("div",{className:"text-[#ff6600] font-bold text-lg",children:f.name}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{children:"Drag & Drop your CSV file here"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"or click to browse"})]})})]}),(0,a.jsxs)("div",{className:"pt-4 flex gap-4",children:[(0,a.jsx)("button",{onClick:()=>m(1),className:"flex-1 py-2 bg-transparent border border-gray-600 text-gray-300 hover:text-white rounded transition-colors",children:"← Back"}),(0,a.jsx)("button",{onClick:N,disabled:!f||x,className:"flex-1 py-2 font-bold rounded transition-colors ".concat(!f||x?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-[#ff6600] hover:bg-[#ff7b24] text-white"),children:x?(0,a.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Analyzing..."]}):"Analyze File"})]})]}),3===h&&w&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-green-500",children:"Step 3: Review Matches"}),(0,a.jsxs)("p",{className:"text-gray-300",children:["We found ",(0,a.jsx)("b",{children:w.matches.length})," matches and ",(0,a.jsx)("b",{children:w.ambiguous.length+w.unmatched.length})," needing attention."]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-[#2a3142]/50 p-4 rounded border border-[#2a3142]",children:[(0,a.jsxs)("h3",{className:"font-bold text-green-400 mb-2",children:["✅ Confirmed Matches (",w.matches.length,")"]}),(0,a.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-2",children:w.matches.map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm p-2 bg-[#1f2533] rounded",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-white font-medium",children:e.item.title}),(0,a.jsxs)("span",{className:"text-gray-500 text-xs ml-2",children:["(",e.item.platform,")"]})]}),(0,a.jsx)("span",{className:"text-green-500 text-xs font-mono",children:"100% Match"})]},t))})]}),(w.ambiguous.length>0||w.unmatched.length>0)&&(0,a.jsxs)("div",{className:"bg-[#2a3142]/50 p-4 rounded border border-[#ff6600]/30",children:[(0,a.jsxs)("h3",{className:"font-bold text-[#ff6600] mb-2",children:["⚠️ Review Required (",w.ambiguous.length+w.unmatched.length,")"]}),(0,a.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-2",children:[...w.ambiguous,...w.unmatched].map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm p-2 bg-[#1f2533] rounded",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white font-medium",children:e.item.title}),(0,a.jsx)("div",{className:"text-gray-500 text-xs",children:e.item.platform})]}),(0,a.jsx)("div",{className:"text-right",children:e.match?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"text-[#ff6600] text-xs",children:["Best Guess: ",e.match.product_name]}),(0,a.jsxs)("div",{className:"text-gray-600 text-xs",children:[e.match.score,"% confidence"]})]}):(0,a.jsx)("span",{className:"text-red-500 text-xs font-mono",children:"No Match"})})]},t))})]})]}),(0,a.jsxs)("div",{className:"pt-4 flex gap-4",children:[(0,a.jsx)("button",{onClick:()=>m(2),className:"flex-1 py-2 bg-transparent border border-gray-600 text-gray-300 hover:text-white rounded transition-colors",children:"← Start Over"}),(0,a.jsx)("button",{onClick:j,disabled:v,className:"flex-1 py-2 font-bold rounded transition-colors ".concat(v?"bg-green-800 text-gray-300 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"),children:v?"Importing...":"Import ".concat(w.matches.length," Items")})]})]})]})]})]})})}function d(e){let{step:t,current:r,title:o}=e,n=t===r,s=t<r;return(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg transition-colors ".concat(n?"bg-[#1f2533] border border-[#ff6600]":"opacity-50"),children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm\n                ".concat(n?"bg-[#ff6600] text-white":s?"bg-green-500 text-white":"bg-gray-700 text-gray-300","\n            "),children:s?"✓":t}),(0,a.jsx)("span",{className:"font-medium ".concat(n?"text-white":"text-gray-400"),children:o})]})}},68435:(e,t,r)=>{"use strict";r.d(t,{A:()=>d,AuthProvider:()=>i});var a=r(95155),o=r(12115),n=r(80022),s=r(85534),l=r(2818);let c=(0,o.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,o.useState)(null),[d,u]=(0,o.useState)(null),[h,m]=(0,o.useState)(!0);(0,o.useEffect)(()=>{let e=localStorage.getItem("rc_token");e?(u(e),(0,s.Ni)(e).then(e=>{e?i(e):p()}).finally(()=>m(!1))):m(!1)},[]);let f=async e=>{let t=await (0,s.XL)(e);t&&t.access_token&&(localStorage.setItem("rc_token",t.access_token),u(t.access_token),i(await (0,s.Ni)(t.access_token)))},p=()=>{localStorage.removeItem("rc_token"),u(null),i(null)},x=l.env.NEXT_PUBLIC_GOOGLE_CLIENT_ID||"";x||console.error("CRITICAL: NEXT_PUBLIC_GOOGLE_CLIENT_ID is missing. Google Login will fail.");let g=async()=>{d&&i(await (0,s.Ni)(d))};return(0,a.jsx)(n.G_,{clientId:x,children:(0,a.jsx)(c.Provider,{value:{user:r,token:d,login:f,logout:p,refreshUser:g,isAuthenticated:!!r,loading:h},children:t})})}function d(){let e=(0,o.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},85534:(e,t,r)=>{"use strict";r.d(t,{$_:()=>b,CG:()=>_,Go:()=>C,Li:()=>p,Ni:()=>h,R1:()=>n,Ri:()=>l,Sb:()=>x,Sz:()=>i,T2:()=>d,TK:()=>g,UQ:()=>c,XL:()=>u,X_:()=>m,bC:()=>y,e9:()=>o,fA:()=>N,jg:()=>w,mQ:()=>j,nL:()=>f,updateProduct:()=>s,xM:()=>v});var a=r(93681);function o(){return a.H}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6?arguments[6]:void 0;try{return(await a.u.get("/products/",{params:{console:e,limit:t,genre:r,type:o,sort:n,skip:s,search:l}})).data}catch(e){return console.error("Error fetching products:",e),[]}}async function s(e,t,r){try{return(await a.u.put("/products/".concat(e),t)).data}catch(t){return console.error("Error updating product ".concat(e,":"),t),null}}async function l(e){try{return(await a.u.get("/products/search/grouped",{params:{query:e}})).data}catch(e){return console.error("Error searching products grouped:",e),{}}}async function c(e){try{let t=await a.u.get("/products/".concat(e,"/listings"),{params:{_t:new Date().getTime()}}),r="true"===t.headers["x-is-stale"];return{data:t.data,isStale:r,status:t.status}}catch(e){var t;return{data:[],isStale:!1,status:(null===(t=e.response)||void 0===t?void 0:t.status)||500}}}async function i(e){try{return(await a.u.get("/products/".concat(e,"/related"))).data}catch(e){return console.error("Error fetching related products:",e),[]}}async function d(e,t,r,o){try{return await a.u.post("/translations/",{locale:e,key:t,value:r},{headers:{"X-Admin-Key":o}}),!0}catch(e){return console.error("Failed to save translation",e),!1}}async function u(e){try{return(await a.u.post("/auth/google",{credential:e})).data}catch(e){var t,r;throw console.error("Google Login failed",e),Error((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.detail)||e.message||"Login failed")}}async function h(e){try{return(await a.u.get("/auth/me")).data}catch(e){return null}}async function m(e){try{return(await a.u.get("/collection/")).data}catch(e){return console.error("Failed to fetch collection",e),[]}}async function f(e,t,r,o,n){try{return(await a.u.post("/collection/",{product_id:t,condition:r,paid_price:n,notes:o})).data}catch(e){var s,l;throw console.error("Failed to add to collection",e),Error((null===(l=e.response)||void 0===l?void 0:null===(s=l.data)||void 0===s?void 0:s.detail)||"Failed to add to collection")}}async function p(e,t,r){try{return(await a.u.put("/collection/".concat(t),r)).data}catch(e){var o,n;throw console.error("Failed to update collection item",e),Error((null===(n=e.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.detail)||"Failed to update item")}}async function x(e,t){try{return await a.u.delete("/collection/".concat(t)),!0}catch(e){return console.error("Failed to delete item",e),!1}}async function g(e,t){try{return(await a.u.put("/auth/me",t)).data}catch(e){throw e}}async function v(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;arguments.length>1&&arguments[1];try{return(await a.u.get("/products/stats/recently-scraped",{params:{limit:e}})).data}catch(e){return console.error("Failed to fetch recently scraped products",e),[]}}async function y(e){try{return(await a.u.get("/portfolio/summary")).data}catch(e){return console.error("Failed to fetch portfolio summary",e),{total_value:0,item_count:0,console_count:0,top_items:[]}}}async function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{return(await a.u.get("/portfolio/history",{params:{range_days:t}})).data}catch(e){return console.error("Failed to fetch portfolio history",e),[]}}async function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{return(await a.u.get("/portfolio/movers",{params:{days:t}})).data}catch(e){return console.error("Failed to fetch portfolio movers",e),{gainers:[],losers:[]}}}async function j(e){try{return(await a.u.get("/portfolio/debug")).data}catch(e){return console.error("Failed to fetch portfolio debug",e),{error:"Failed to fetch debug info"}}}async function N(e){try{return(await a.u.get("/portfolio/dashboard")).data}catch(e){return console.error("Failed to fetch portfolio dashboard",e),null}}async function _(e,t){let r=new FormData;r.append("file",e);try{return(await a.u.post("/import/upload",r,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(e){var o,n;throw console.error("CSV upload failed",e),Error((null===(n=e.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.detail)||"Upload failed")}}async function C(e,t){try{return(await a.u.post("/import/confirm",{items:e})).data}catch(e){var r,o;throw console.error("Bulk import failed",e),Error((null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.detail)||"Import failed")}}},93681:(e,t,r)=>{"use strict";r.d(t,{H:()=>s,u:()=>l});var a=r(82651),o=r(2818);let n=o.env.NEXT_PUBLIC_API_URL?o.env.NEXT_PUBLIC_API_URL:"https://retrocharting-backend.onrender.com",s="".concat(n,"/api/v1"),l=a.A.create({baseURL:s,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>{{let t=localStorage.getItem("rc_token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),l.interceptors.response.use(e=>e,e=>Promise.reject(e))}},e=>{var t=t=>e(e.s=t);e.O(0,[5714,2651,8441,1517,7358],()=>t(52637)),_N_E=e.O()}]);