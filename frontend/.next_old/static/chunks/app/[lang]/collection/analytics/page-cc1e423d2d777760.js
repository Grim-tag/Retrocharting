(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5547],{40648:(e,t,r)=>{Promise.resolve().then(r.bind(r,36884))},36884:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v,dynamic:()=>b});var a=r(95155),o=r(12115),n=r(68435),l=r(85534),i=r(76046),s=r(11977),c=r(31558),d=r(85572),u=r(36),x=r(15255),h=r(12800),p=r(66963),f=r(71214),m=r(85093);let b="force-dynamic";function v(){var e,t;let{token:r,isAuthenticated:b}=(0,n.A)();(0,i.useRouter)();let v=(0,i.useParams)();null==v||v.lang;let{currency:g}=(0,c.H)(),[y,j]=(0,o.useState)(null),[N,w]=(0,o.useState)([]),[k,_]=(0,o.useState)(null),[C,E]=(0,o.useState)(null),[S,T]=(0,o.useState)(!0),[P,I]=(0,o.useState)(!1),[L,F]=(0,o.useState)("");if((0,o.useEffect)(()=>{I(!0),F(new Date().toLocaleDateString())},[]),(0,o.useEffect)(()=>{b&&e();async function e(){if(r){T(!0);try{let[e,t,a]=await Promise.all([(0,l.bC)(r),(0,l.jg)(r,-1),(0,l.$_)(r,30)]);if(j(e),w(t),_(a),!t||0===t.length){let e=await (0,l.mQ)(r);E(e)}}catch(e){console.error("Failed to load analytics data",e)}finally{T(!1)}}}},[r,b]),!P)return null;if(!b)return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-[#0f121e] text-white",children:(0,a.jsx)("p",{children:"Please log in to view your portfolio analytics."})});if(S)return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-[#0f121e] text-white",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[#ff6600]"})});let D=(0,s.Tt)((null==y?void 0:y.total_value)||0,g),U=(0,s.Tt)((null==y?void 0:y.total_invested)||0,g),G=(0,s.Tt)((null==y?void 0:y.total_profit)||0,g),A=Array.isArray(N)?N.map(e=>({...e,value:(0,s.Tt)(e.value||0,g),invested:(0,s.Tt)(e.invested||0,g)})):[];return(0,a.jsx)("div",{className:"min-h-screen bg-[#0f121e] py-8 text-white print:bg-white print:text-black",children:(0,a.jsxs)("div",{className:"max-w-[1400px] mx-auto px-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8 print:hidden",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Portfolio Analytics"}),(0,a.jsx)("p",{className:"text-gray-400",children:"Track your collection value and performance."})]}),(0,a.jsx)("button",{onClick:()=>window.print(),className:"bg-[#2a3142] hover:bg-[#353e54] text-white font-bold py-2 px-4 rounded border border-[#3a4152]",children:"\uD83D\uDDA8️ Print Report"})]}),(0,a.jsxs)("div",{className:"hidden print:block mb-8 border-b-2 border-black pb-4",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold",children:"Collection Valuation Report"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Generated on ",L]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-[#1f2533] p-6 rounded-xl border border-[#2a3142] print:border-black print:bg-white",children:[(0,a.jsx)("h3",{className:"text-gray-400 uppercase text-xs font-bold mb-2 print:text-black",children:"Total Value"}),(0,a.jsx)("div",{className:"text-3xl font-bold text-[#22c55e]",children:(0,s.$g)(D,g)}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-2",children:"Current market value"})]}),(0,a.jsxs)("div",{className:"bg-[#1f2533] p-6 rounded-xl border border-[#2a3142] print:border-black print:bg-white",children:[(0,a.jsx)("h3",{className:"text-gray-400 uppercase text-xs font-bold mb-2 print:text-black",children:"Total Invested"}),(0,a.jsx)("div",{className:"text-3xl font-bold text-white print:text-black",children:(0,s.$g)(U,g)}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-2",children:"Based on paid price"})]}),(0,a.jsxs)("div",{className:"bg-[#1f2533] p-6 rounded-xl border border-[#2a3142] print:border-black print:bg-white",children:[(0,a.jsx)("h3",{className:"text-gray-400 uppercase text-xs font-bold mb-2 print:text-black",children:"Total Profit"}),(0,a.jsxs)("div",{className:"text-3xl font-bold ".concat(G&&G>=0?"text-[#22c55e]":"text-red-500"),children:[G&&G>0?"+":"",(0,s.$g)(G,g)]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-2",children:"Unrealized gains"})]}),(0,a.jsxs)("div",{className:"bg-[#1f2533] p-6 rounded-xl border border-[#2a3142] print:border-black print:bg-white",children:[(0,a.jsx)("h3",{className:"text-gray-400 uppercase text-xs font-bold mb-2 print:text-black",children:"Most Valuable"}),(null==y?void 0:null===(e=y.top_items)||void 0===e?void 0:e[0])?(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-bold text-white truncate print:text-black",title:y.top_items[0].name,children:y.top_items[0].name}),(0,a.jsx)("div",{className:"text-[#ff6600] font-bold text-xl",children:(0,s.$g)((0,s.Tt)(y.top_items[0].value,g),g)})]}):(0,a.jsx)("div",{className:"text-gray-500",children:"No items yet"})]})]}),(0,a.jsxs)("div",{className:"bg-[#1f2533] p-6 rounded-xl border border-[#2a3142] mb-8 print:border-black print:bg-white print:break-inside-avoid",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-6 print:text-black",children:"Value History (Calculated from Acquisition)"}),(0,a.jsx)("div",{className:"h-[300px] w-full",children:P&&A.length>0?(0,a.jsx)(d.u,{width:"100%",height:"100%",children:(0,a.jsxs)(u.Q,{data:A,children:[(0,a.jsxs)("defs",{children:[(0,a.jsxs)("linearGradient",{id:"colorValue",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,a.jsx)("stop",{offset:"5%",stopColor:"#22c55e",stopOpacity:.3}),(0,a.jsx)("stop",{offset:"95%",stopColor:"#22c55e",stopOpacity:0})]}),(0,a.jsxs)("linearGradient",{id:"colorInvested",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,a.jsx)("stop",{offset:"5%",stopColor:"#ef4444",stopOpacity:.3}),(0,a.jsx)("stop",{offset:"95%",stopColor:"#ef4444",stopOpacity:0})]})]}),(0,a.jsx)(x.d,{strokeDasharray:"3 3",stroke:"#2a3142",vertical:!1}),(0,a.jsx)(h.W,{dataKey:"date",tickFormatter:e=>{if(!e)return"";let t=new Date(e);return isNaN(t.getTime())?"":t.getDate().toString()},stroke:"#6b7280",tickLine:!1,axisLine:!1}),(0,a.jsx)(p.h,{stroke:"#6b7280",tickLine:!1,axisLine:!1,tickFormatter:e=>{let t="EUR"===g?"€":"GBP"===g?"\xa3":"$";return e>=1e3?"".concat(t).concat((e/1e3).toFixed(1),"k"):"".concat(t).concat(e)}}),(0,a.jsx)(f.m,{contentStyle:{backgroundColor:"#1f2533",borderColor:"#2a3142",color:"#fff"},formatter:(e,t)=>[(0,s.$g)(e,g),"value"===t?"Market Value":"Invested"],labelFormatter:e=>{if(!e)return"";let t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleDateString()}}),(0,a.jsx)(m.Gk,{type:"monotone",dataKey:"value",name:"value",stroke:"#22c55e",strokeWidth:3,fillOpacity:1,fill:"url(#colorValue)"}),(0,a.jsx)(m.Gk,{type:"monotone",dataKey:"invested",name:"invested",stroke:"#ef4444",strokeWidth:2,fillOpacity:1,fill:"url(#colorInvested)"})]})}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-500 gap-4",children:[(0,a.jsx)("p",{children:P?"No history data available yet.":"Loading chart..."}),C&&(0,a.jsxs)("div",{className:"text-xs font-mono text-left bg-black p-4 rounded border border-gray-700 max-w-lg overflow-auto",children:[(0,a.jsx)("p",{className:"font-bold text-[#ff6600] mb-2",children:"DEBUG INFO:"}),(0,a.jsx)("pre",{children:JSON.stringify(C,null,2)})]})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 print:grid-cols-1",children:[(0,a.jsxs)("div",{className:"bg-[#1f2533] p-6 rounded-xl border border-[#2a3142] print:border-black print:bg-white print:break-inside-avoid",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-4 print:text-black",children:"Top 5 Most Valuable"}),null==y?void 0:null===(t=y.top_items)||void 0===t?void 0:t.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between py-3 border-b border-[#2a3142] last:border-0 print:border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("span",{className:"text-gray-500 font-mono w-4",children:["#",t+1]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-bold print:text-black",children:e.name}),(0,a.jsx)("div",{className:"text-xs text-gray-400",children:e.console})]})]}),(0,a.jsx)("div",{className:"font-bold text-[#ff6600]",children:(0,s.$g)((0,s.Tt)(e.value,g),g)})]},t))]}),(0,a.jsxs)("div",{className:"bg-[#1f2533] p-6 rounded-xl border border-[#2a3142] print:border-black print:bg-white print:break-inside-avoid",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-4 print:text-black",children:"Top Movers (30 Days)"}),(null==k?void 0:k.gainers)&&k.gainers.length>0?k.gainers.slice(0,5).map((e,t)=>{let r=(0,s.Tt)(e.current_price,g),o=(0,s.Tt)(e.abs_change,g);return(0,a.jsxs)("div",{className:"flex items-center justify-between py-3 border-b border-[#2a3142] last:border-0 print:border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"text-green-500 bg-green-500/10 px-2 py-1 rounded text-xs font-bold",children:["+",e.pct_change,"%"]}),(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"font-bold print:text-black",children:e.name})})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"font-bold text-white print:text-black",children:(0,s.$g)(r,g)}),(0,a.jsxs)("div",{className:"text-xs text-green-500",children:["+",(0,s.$g)(o,g)]})]})]},t)}):(0,a.jsx)("div",{className:"text-gray-500 text-center py-8",children:"No significant movement yet."})]})]})]})})}},68435:(e,t,r)=>{"use strict";r.d(t,{A:()=>d,AuthProvider:()=>c});var a=r(95155),o=r(12115),n=r(80022),l=r(85534),i=r(2818);let s=(0,o.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,o.useState)(null),[d,u]=(0,o.useState)(null),[x,h]=(0,o.useState)(!0);(0,o.useEffect)(()=>{let e=localStorage.getItem("rc_token");e?(u(e),(0,l.Ni)(e).then(e=>{e?c(e):f()}).finally(()=>h(!1))):h(!1)},[]);let p=async e=>{let t=await (0,l.XL)(e);t&&t.access_token&&(localStorage.setItem("rc_token",t.access_token),u(t.access_token),c(await (0,l.Ni)(t.access_token)))},f=()=>{localStorage.removeItem("rc_token"),u(null),c(null)},m=i.env.NEXT_PUBLIC_GOOGLE_CLIENT_ID||"";m||console.error("CRITICAL: NEXT_PUBLIC_GOOGLE_CLIENT_ID is missing. Google Login will fail.");let b=async()=>{d&&c(await (0,l.Ni)(d))};return(0,a.jsx)(n.G_,{clientId:m,children:(0,a.jsx)(s.Provider,{value:{user:r,token:d,login:p,logout:f,refreshUser:b,isAuthenticated:!!r,loading:x},children:t})})}function d(){let e=(0,o.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},31558:(e,t,r)=>{"use strict";r.d(t,{CurrencyProvider:()=>l,H:()=>i});var a=r(95155),o=r(12115);let n=(0,o.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,o.useState)("USD");return(0,o.useEffect)(()=>{let e=localStorage.getItem("retrocharting_currency");e&&("USD"===e||"EUR"===e||"GBP"===e)&&l(e)},[]),(0,a.jsx)(n.Provider,{value:{currency:r,setCurrency:e=>{l(e),localStorage.setItem("retrocharting_currency",e)}},children:t})}function i(){let e=(0,o.useContext)(n);if(void 0===e)throw Error("useCurrency must be used within a CurrencyProvider");return e}},85534:(e,t,r)=>{"use strict";r.d(t,{$_:()=>j,CG:()=>k,Go:()=>_,Li:()=>f,Ni:()=>x,R1:()=>n,Ri:()=>i,Sb:()=>m,Sz:()=>c,T2:()=>d,TK:()=>b,UQ:()=>s,XL:()=>u,X_:()=>h,bC:()=>g,e9:()=>o,fA:()=>w,jg:()=>y,mQ:()=>N,nL:()=>p,updateProduct:()=>l,xM:()=>v});var a=r(93681);function o(){return a.H}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=arguments.length>6?arguments[6]:void 0;try{return(await a.u.get("/products/",{params:{console:e,limit:t,genre:r,type:o,sort:n,skip:l,search:i}})).data}catch(e){return console.error("Error fetching products:",e),[]}}async function l(e,t,r){try{return(await a.u.put("/products/".concat(e),t)).data}catch(t){return console.error("Error updating product ".concat(e,":"),t),null}}async function i(e){try{return(await a.u.get("/products/search/grouped",{params:{query:e}})).data}catch(e){return console.error("Error searching products grouped:",e),{}}}async function s(e){try{let t=await a.u.get("/products/".concat(e,"/listings"),{params:{_t:new Date().getTime()}}),r="true"===t.headers["x-is-stale"];return{data:t.data,isStale:r,status:t.status}}catch(e){var t;return{data:[],isStale:!1,status:(null===(t=e.response)||void 0===t?void 0:t.status)||500}}}async function c(e){try{return(await a.u.get("/products/".concat(e,"/related"))).data}catch(e){return console.error("Error fetching related products:",e),[]}}async function d(e,t,r,o){try{return await a.u.post("/translations/",{locale:e,key:t,value:r},{headers:{"X-Admin-Key":o}}),!0}catch(e){return console.error("Failed to save translation",e),!1}}async function u(e){try{return(await a.u.post("/auth/google",{credential:e})).data}catch(e){var t,r;throw console.error("Google Login failed",e),Error((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.detail)||e.message||"Login failed")}}async function x(e){try{return(await a.u.get("/auth/me")).data}catch(e){return null}}async function h(e){try{return(await a.u.get("/collection/")).data}catch(e){return console.error("Failed to fetch collection",e),[]}}async function p(e,t,r,o,n){try{return(await a.u.post("/collection/",{product_id:t,condition:r,paid_price:n,notes:o})).data}catch(e){var l,i;throw console.error("Failed to add to collection",e),Error((null===(i=e.response)||void 0===i?void 0:null===(l=i.data)||void 0===l?void 0:l.detail)||"Failed to add to collection")}}async function f(e,t,r){try{return(await a.u.put("/collection/".concat(t),r)).data}catch(e){var o,n;throw console.error("Failed to update collection item",e),Error((null===(n=e.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.detail)||"Failed to update item")}}async function m(e,t){try{return await a.u.delete("/collection/".concat(t)),!0}catch(e){return console.error("Failed to delete item",e),!1}}async function b(e,t){try{return(await a.u.put("/auth/me",t)).data}catch(e){throw e}}async function v(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;arguments.length>1&&arguments[1];try{return(await a.u.get("/products/stats/recently-scraped",{params:{limit:e}})).data}catch(e){return console.error("Failed to fetch recently scraped products",e),[]}}async function g(e){try{return(await a.u.get("/portfolio/summary")).data}catch(e){return console.error("Failed to fetch portfolio summary",e),{total_value:0,item_count:0,console_count:0,top_items:[]}}}async function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{return(await a.u.get("/portfolio/history",{params:{range_days:t}})).data}catch(e){return console.error("Failed to fetch portfolio history",e),[]}}async function j(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{return(await a.u.get("/portfolio/movers",{params:{days:t}})).data}catch(e){return console.error("Failed to fetch portfolio movers",e),{gainers:[],losers:[]}}}async function N(e){try{return(await a.u.get("/portfolio/debug")).data}catch(e){return console.error("Failed to fetch portfolio debug",e),{error:"Failed to fetch debug info"}}}async function w(e){try{return(await a.u.get("/portfolio/dashboard")).data}catch(e){return console.error("Failed to fetch portfolio dashboard",e),null}}async function k(e,t){let r=new FormData;r.append("file",e);try{return(await a.u.post("/import/upload",r,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(e){var o,n;throw console.error("CSV upload failed",e),Error((null===(n=e.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.detail)||"Upload failed")}}async function _(e,t){try{return(await a.u.post("/import/confirm",{items:e})).data}catch(e){var r,o;throw console.error("Bulk import failed",e),Error((null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.detail)||"Import failed")}}},93681:(e,t,r)=>{"use strict";r.d(t,{H:()=>l,u:()=>i});var a=r(82651),o=r(2818);let n=o.env.NEXT_PUBLIC_API_URL?o.env.NEXT_PUBLIC_API_URL:"https://retrocharting-backend.onrender.com",l="".concat(n,"/api/v1"),i=a.A.create({baseURL:l,headers:{"Content-Type":"application/json"}});i.interceptors.request.use(e=>{{let t=localStorage.getItem("rc_token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),i.interceptors.response.use(e=>e,e=>Promise.reject(e))},11977:(e,t,r)=>{"use strict";r.d(t,{$g:()=>s,Q3:()=>i,Qn:()=>n,Tt:()=>l,VK:()=>o});let a={USD:1,EUR:.95,GBP:.79},o=[{code:"USD",label:"USD ($)",symbol:"$"},{code:"EUR",label:"EUR (€)",symbol:"€"},{code:"GBP",label:"GBP (\xa3)",symbol:"\xa3"}];function n(e){let t=o.find(t=>t.code===e);return t?t.symbol:"$"}function l(e,t){return null==e?null:e*(a[t]||1)}function i(e,t){let r=a[t]||1;return 0===r?0:e/r}function s(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"en-US";if(null==e)return"--";let a=l(e,t);if(null===a)return"--";try{return new Intl.NumberFormat(r,{style:"currency",currency:t}).format(a)}catch(e){return"".concat(t," ").concat(a.toFixed(2))}}}},e=>{var t=t=>e(e.s=t);e.O(0,[5714,2651,6802,7643,8441,1517,7358],()=>t(40648)),_N_E=e.O()}]);