(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5957],{11107:(e,t,r)=>{Promise.resolve().then(r.bind(r,52606))},80022:(e,t,r)=>{"use strict";r.d(t,{G_:()=>n,j:()=>i});var a=r(12115);let o=(0,a.createContext)(null);function n(e){let{clientId:t,nonce:r,onScriptLoadSuccess:n,onScriptLoadError:l,children:i}=e,s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{nonce:t,onScriptLoadSuccess:r,onScriptLoadError:o}=e,[n,l]=(0,a.useState)(!1),i=(0,a.useRef)(r);i.current=r;let s=(0,a.useRef)(o);return s.current=o,(0,a.useEffect)(()=>{let e=document.createElement("script");return e.src="https://accounts.google.com/gsi/client",e.async=!0,e.defer=!0,e.nonce=t,e.onload=()=>{var e;l(!0),null===(e=i.current)||void 0===e||e.call(i)},e.onerror=()=>{var e;l(!1),null===(e=s.current)||void 0===e||e.call(s)},document.body.appendChild(e),()=>{document.body.removeChild(e)}},[t]),n}({nonce:r,onScriptLoadSuccess:n,onScriptLoadError:l}),c=(0,a.useMemo)(()=>({clientId:t,scriptLoadedSuccessfully:s}),[t,s]);return a.createElement(o.Provider,{value:c},i)}let l={large:40,medium:32,small:20};function i(e){let{onSuccess:t,onError:r,useOneTap:n,promptMomentNotification:i,type:s="standard",theme:c="outline",size:d="large",text:u,shape:h,logo_alignment:g,width:p,locale:m,click_listener:x,containerProps:v,...f}=e,y=(0,a.useRef)(null),{clientId:w,scriptLoadedSuccessfully:b}=function(){let e=(0,a.useContext)(o);if(!e)throw Error("Google OAuth components must be used within GoogleOAuthProvider");return e}(),j=(0,a.useRef)(t);j.current=t;let N=(0,a.useRef)(r);N.current=r;let _=(0,a.useRef)(i);return _.current=i,(0,a.useEffect)(()=>{var e,t,r,a,o,l,i,v,S;if(b)return null===(r=null===(t=null===(e=null==window?void 0:window.google)||void 0===e?void 0:e.accounts)||void 0===t?void 0:t.id)||void 0===r||r.initialize({client_id:w,callback:e=>{var t,r;if(!(null==e?void 0:e.credential))return null===(t=N.current)||void 0===t?void 0:t.call(N);let{credential:a,select_by:o}=e;j.current({credential:a,clientId:null!==(r=null==e?void 0:e.clientId)&&void 0!==r?r:null==e?void 0:e.client_id,select_by:o})},...f}),null===(l=null===(o=null===(a=null==window?void 0:window.google)||void 0===a?void 0:a.accounts)||void 0===o?void 0:o.id)||void 0===l||l.renderButton(y.current,{type:s,theme:c,size:d,text:u,shape:h,logo_alignment:g,width:p,locale:m,click_listener:x}),n&&(null===(S=null===(v=null===(i=null==window?void 0:window.google)||void 0===i?void 0:i.accounts)||void 0===v?void 0:v.id)||void 0===S||S.prompt(_.current)),()=>{var e,t,r;n&&(null===(r=null===(t=null===(e=null==window?void 0:window.google)||void 0===e?void 0:e.accounts)||void 0===t?void 0:t.id)||void 0===r||r.cancel())}},[w,b,n,s,c,d,u,h,g,p,m]),a.createElement("div",{...v,ref:y,style:{height:l[d],...null==v?void 0:v.style}})}},52606:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var a=r(95155),o=r(12115),n=r(68435),l=r(93681);function i(){var e;let{token:t}=(0,n.A)(),[r,i]=(0,o.useState)(null),[u,h]=(0,o.useState)([]),[g,p]=(0,o.useState)(!0),m=async()=>{if(t)try{let[e,t]=await Promise.all([l.u.get("/admin/stats"),l.u.get("/admin/users")]);i(e.data),h(t.data)}catch(e){console.error("Failed to load admin data",e)}finally{p(!1)}};return((0,o.useEffect)(()=>{m()},[t]),g)?(0,a.jsx)("div",{className:"text-white p-8",children:"Loading dashboard data..."}):(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,a.jsx)(c,{label:"Total Products",value:r?r.total_products.toLocaleString():"-"}),(0,a.jsx)(c,{label:"Scraped Data",value:r?"".concat(r.scraped_percentage,"%"):"-",subtext:r?"".concat(r.scraped_products.toLocaleString()," items"):void 0}),(0,a.jsx)(c,{label:"Total Value (CIB)",value:r?"".concat(r.total_value.toLocaleString()):"-",highlight:!0}),(0,a.jsx)(c,{label:"Images to Migrate",value:(null==r?void 0:r.pending_image_migration)?r.pending_image_migration.toLocaleString():"0",highlight:!!(null==r?void 0:r.pending_image_migration)&&r.pending_image_migration>0,status:(null==r?void 0:r.pending_image_migration)&&r.pending_image_migration>0?"red":"green"}),(0,a.jsxs)("div",{className:"col-span-full mt-8 p-6 bg-[#1f2533] border border-[#2a3142] rounded",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Welcome to RetroCharting Admin"}),(0,a.jsxs)("p",{className:"text-gray-400",children:["Your database is currently tracking ",(0,a.jsx)("strong",{children:null!==(e=null==r?void 0:r.total_products.toLocaleString())&&void 0!==e?e:0})," products."]}),(0,a.jsxs)("div",{className:"mt-6 pt-6 border-t border-[#2a3142]",children:[(0,a.jsx)("h3",{className:"text-lg font-bold mb-4 text-white",children:"Maintenance Tools"}),(0,a.jsx)("div",{className:"flex gap-4",children:(0,a.jsx)(d,{pendingCount:null==r?void 0:r.pending_image_migration,onRefreshStats:m})})]})]}),(0,a.jsx)(s,{users:u})]})}function s(e){let{users:t}=e;return(0,a.jsxs)("div",{className:"col-span-full p-6 bg-[#1f2533] border border-[#2a3142] rounded",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold mb-4 text-white",children:["User Management (",t.length,")"]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-left text-sm text-gray-400",children:[(0,a.jsx)("thead",{className:"text-xs uppercase bg-[#2a3142] text-gray-200",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3",children:"ID"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"User"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Rank / XP"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Role"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Joined"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Last Active"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"IP Address"})]})}),(0,a.jsxs)("tbody",{className:"divide-y divide-[#2a3142]",children:[t.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-[#2a3142]/50",children:[(0,a.jsxs)("td",{className:"px-4 py-3 text-white",children:["#",e.id]}),(0,a.jsxs)("td",{className:"px-4 py-3",children:[(0,a.jsx)("div",{className:"text-white font-medium",children:e.username||"No Pseudo"}),(0,a.jsx)("div",{className:"text-xs",children:e.email})]}),(0,a.jsxs)("td",{className:"px-4 py-3",children:[(0,a.jsx)("span",{className:"text-[#ff6600] font-bold",children:e.rank}),(0,a.jsxs)("div",{className:"text-xs",children:[e.xp.toLocaleString()," XP"]})]}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.is_admin?(0,a.jsx)("span",{className:"px-2 py-1 rounded bg-purple-900 text-purple-200 text-xs",children:"Admin"}):(0,a.jsx)("span",{className:"px-2 py-1 rounded bg-gray-700 text-gray-300 text-xs",children:"User"})}),(0,a.jsx)("td",{className:"px-4 py-3",children:new Date(e.created_at).toLocaleDateString()}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.last_active?new Date(e.last_active).toLocaleString():"Never"}),(0,a.jsx)("td",{className:"px-4 py-3 font-mono text-xs text-gray-400",children:e.ip_address||"-"})]},e.id)),0===t.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:7,className:"px-4 py-8 text-center text-gray-500",children:"No users found."})})]})]})})]})}function c(e){let{label:t,value:r,subtext:o,highlight:n,status:l}=e;return(0,a.jsxs)("div",{className:"bg-[#1f2533] p-6 rounded border border-[#2a3142]",children:[(0,a.jsxs)("div",{className:"text-gray-400 text-sm uppercase tracking-wider mb-2 flex justify-between",children:[t,l&&(0,a.jsx)("span",{className:"h-2 w-2 rounded-full ".concat("green"===l?"bg-green-500":"bg-red-500")})]}),(0,a.jsx)("div",{className:"text-3xl font-bold ".concat(n?"text-[#ff6600]":"text-white"),children:r}),o&&(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:o})]})}function d(e){var t;let{pendingCount:r,onRefreshStats:n}=e,[i,s]=(0,o.useState)(!1),[c,d]=(0,o.useState)(0),[u,h]=(0,o.useState)("Ready"),g=(0,o.useRef)(!1),p=async()=>{h("Initializing...");let e=0;for(;g.current;)try{h("Migrating batch... (Session total: ".concat(e,")"));let t=await l.u.post("/admin/images/migrate?limit=50"),r=t.data.migrated||0;if(e+=r,d(e),n(),0===r&&"completed"===t.data.status){h("All images migrated! \uD83C\uDF89"),s(!1),g.current=!1;break}h("Waiting cooldown... (Session total: ".concat(e,")")),await new Promise(e=>setTimeout(e,1500))}catch(e){console.error("Migration loop error",e),h("Error in batch. Retrying in 5s..."),await new Promise(e=>setTimeout(e,5e3))}g.current||"All images migrated! \uD83C\uDF89"===u||h("Stopped by user.")};return(0,a.jsxs)("div",{className:"flex flex-col items-start gap-3 bg-[#2a3142]/50 p-4 rounded border border-[#2a3142]",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("button",{onClick:()=>{if(i)s(!1),g.current=!1,h("Stopping...");else{if(!confirm("Start auto-migration? This will process batches of 50 until complete or stopped."))return;s(!0),g.current=!0,p()}},className:"px-6 py-2 rounded font-bold transition-colors ".concat(i?"bg-red-600 hover:bg-red-700 text-white animate-pulse":"bg-green-600 hover:bg-green-700 text-white"),children:i?"STOP MIGRATION":"START AUTO-MIGRATION"}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300 font-mono",children:u}),i&&(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"Do not close this tab."})]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-700 h-2 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-blue-500 transition-all duration-500",style:{width:r&&r>0?"".concat(Math.min(100,c/(c+r)*100),"%"):"0%"}})}),(0,a.jsxs)("div",{className:"text-xs text-gray-400 flex gap-4",children:[(0,a.jsxs)("span",{children:["Remaining: ",(0,a.jsx)("strong",{className:"text-white",children:null!==(t=null==r?void 0:r.toLocaleString())&&void 0!==t?t:0})]}),(0,a.jsxs)("span",{children:["Session Processed: ",(0,a.jsx)("strong",{className:"text-green-400",children:c.toLocaleString()})]})]})]})}},68435:(e,t,r)=>{"use strict";r.d(t,{A:()=>d,AuthProvider:()=>c});var a=r(95155),o=r(12115),n=r(80022),l=r(85534),i=r(2818);let s=(0,o.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,o.useState)(null),[d,u]=(0,o.useState)(null),[h,g]=(0,o.useState)(!0);(0,o.useEffect)(()=>{let e=localStorage.getItem("rc_token");e?(u(e),(0,l.Ni)(e).then(e=>{e?c(e):m()}).finally(()=>g(!1))):g(!1)},[]);let p=async e=>{let t=await (0,l.XL)(e);t&&t.access_token&&(localStorage.setItem("rc_token",t.access_token),u(t.access_token),c(await (0,l.Ni)(t.access_token)))},m=()=>{localStorage.removeItem("rc_token"),u(null),c(null)},x=i.env.NEXT_PUBLIC_GOOGLE_CLIENT_ID||"";x||console.error("CRITICAL: NEXT_PUBLIC_GOOGLE_CLIENT_ID is missing. Google Login will fail.");let v=async()=>{d&&c(await (0,l.Ni)(d))};return(0,a.jsx)(n.G_,{clientId:x,children:(0,a.jsx)(s.Provider,{value:{user:r,token:d,login:p,logout:m,refreshUser:v,isAuthenticated:!!r,loading:h},children:t})})}function d(){let e=(0,o.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},85534:(e,t,r)=>{"use strict";r.d(t,{$_:()=>b,CG:()=>_,Go:()=>S,Li:()=>m,Ni:()=>h,R1:()=>n,Ri:()=>i,Sb:()=>x,Sz:()=>c,T2:()=>d,TK:()=>v,UQ:()=>s,XL:()=>u,X_:()=>g,bC:()=>y,e9:()=>o,fA:()=>N,jg:()=>w,mQ:()=>j,nL:()=>p,updateProduct:()=>l,xM:()=>f});var a=r(93681);function o(){return a.H}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=arguments.length>6?arguments[6]:void 0;try{return(await a.u.get("/products/",{params:{console:e,limit:t,genre:r,type:o,sort:n,skip:l,search:i}})).data}catch(e){return console.error("Error fetching products:",e),[]}}async function l(e,t,r){try{return(await a.u.put("/products/".concat(e),t)).data}catch(t){return console.error("Error updating product ".concat(e,":"),t),null}}async function i(e){try{return(await a.u.get("/products/search/grouped",{params:{query:e}})).data}catch(e){return console.error("Error searching products grouped:",e),{}}}async function s(e){try{let t=await a.u.get("/products/".concat(e,"/listings"),{params:{_t:new Date().getTime()}}),r="true"===t.headers["x-is-stale"];return{data:t.data,isStale:r,status:t.status}}catch(e){var t;return{data:[],isStale:!1,status:(null===(t=e.response)||void 0===t?void 0:t.status)||500}}}async function c(e){try{return(await a.u.get("/products/".concat(e,"/related"))).data}catch(e){return console.error("Error fetching related products:",e),[]}}async function d(e,t,r,o){try{return await a.u.post("/translations/",{locale:e,key:t,value:r},{headers:{"X-Admin-Key":o}}),!0}catch(e){return console.error("Failed to save translation",e),!1}}async function u(e){try{return(await a.u.post("/auth/google",{credential:e})).data}catch(e){var t,r;throw console.error("Google Login failed",e),Error((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.detail)||e.message||"Login failed")}}async function h(e){try{return(await a.u.get("/auth/me")).data}catch(e){return null}}async function g(e){try{return(await a.u.get("/collection/")).data}catch(e){return console.error("Failed to fetch collection",e),[]}}async function p(e,t,r,o,n){try{return(await a.u.post("/collection/",{product_id:t,condition:r,paid_price:n,notes:o})).data}catch(e){var l,i;throw console.error("Failed to add to collection",e),Error((null===(i=e.response)||void 0===i?void 0:null===(l=i.data)||void 0===l?void 0:l.detail)||"Failed to add to collection")}}async function m(e,t,r){try{return(await a.u.put("/collection/".concat(t),r)).data}catch(e){var o,n;throw console.error("Failed to update collection item",e),Error((null===(n=e.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.detail)||"Failed to update item")}}async function x(e,t){try{return await a.u.delete("/collection/".concat(t)),!0}catch(e){return console.error("Failed to delete item",e),!1}}async function v(e,t){try{return(await a.u.put("/auth/me",t)).data}catch(e){throw e}}async function f(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;arguments.length>1&&arguments[1];try{return(await a.u.get("/products/stats/recently-scraped",{params:{limit:e}})).data}catch(e){return console.error("Failed to fetch recently scraped products",e),[]}}async function y(e){try{return(await a.u.get("/portfolio/summary")).data}catch(e){return console.error("Failed to fetch portfolio summary",e),{total_value:0,item_count:0,console_count:0,top_items:[]}}}async function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{return(await a.u.get("/portfolio/history",{params:{range_days:t}})).data}catch(e){return console.error("Failed to fetch portfolio history",e),[]}}async function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{return(await a.u.get("/portfolio/movers",{params:{days:t}})).data}catch(e){return console.error("Failed to fetch portfolio movers",e),{gainers:[],losers:[]}}}async function j(e){try{return(await a.u.get("/portfolio/debug")).data}catch(e){return console.error("Failed to fetch portfolio debug",e),{error:"Failed to fetch debug info"}}}async function N(e){try{return(await a.u.get("/portfolio/dashboard")).data}catch(e){return console.error("Failed to fetch portfolio dashboard",e),null}}async function _(e,t){let r=new FormData;r.append("file",e);try{return(await a.u.post("/import/upload",r,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(e){var o,n;throw console.error("CSV upload failed",e),Error((null===(n=e.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.detail)||"Upload failed")}}async function S(e,t){try{return(await a.u.post("/import/confirm",{items:e})).data}catch(e){var r,o;throw console.error("Bulk import failed",e),Error((null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.detail)||"Import failed")}}},93681:(e,t,r)=>{"use strict";r.d(t,{H:()=>l,u:()=>i});var a=r(82651),o=r(2818);let n=o.env.NEXT_PUBLIC_API_URL?o.env.NEXT_PUBLIC_API_URL:"https://retrocharting-backend.onrender.com",l="".concat(n,"/api/v1"),i=a.A.create({baseURL:l,headers:{"Content-Type":"application/json"}});i.interceptors.request.use(e=>{{let t=localStorage.getItem("rc_token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),i.interceptors.response.use(e=>e,e=>Promise.reject(e))}},e=>{var t=t=>e(e.s=t);e.O(0,[5714,2651,8441,1517,7358],()=>t(11107)),_N_E=e.O()}]);