(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6409],{34157:(e,t,r)=>{Promise.resolve().then(r.bind(r,70344))},70344:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var a=r(95155),o=r(12115),n=r(68435),c=r(91573),s=r(57288),i=r(21233);function l(){let{user:e}=(0,n.A)(),[t,r]=(0,o.useState)([]),[l,p]=(0,o.useState)(!0),[h,m]=(0,o.useState)("pending");(0,o.useEffect)(()=>{e&&e.is_admin&&f()},[e,h]);let f=async()=>{p(!0);try{let e=localStorage.getItem("token")||"",t=await (0,c.Ss)(h,e);r(t)}catch(e){console.error(e)}finally{p(!1)}},g=async(e,t)=>{try{let a=localStorage.getItem("token")||"";await (0,c.Tk)(e,t,a),r(t=>t.filter(t=>t.id!==e))}catch(e){alert("Erreur lors de la mise \xe0 jour")}},v=async()=>{if(confirm("Voulez-vous vraiment supprimer TOUS les commentaires refus\xe9s ? Cette action est irr\xe9versible."))try{let e=localStorage.getItem("token")||"";await (0,c.av)(e),f()}catch(e){alert("Erreur lors de la suppression")}};return e&&e.is_admin?(0,a.jsx)("main",{className:"bg-[#0f121e] min-h-screen p-8",children:(0,a.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-white",children:"Mod\xe9ration des Commentaires"}),"rejected"===h&&t.length>0&&(0,a.jsxs)("button",{onClick:v,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm font-bold flex items-center gap-2",children:[(0,a.jsx)("span",{children:"\uD83D\uDDD1️"})," Vider la corbeille"]})]}),(0,a.jsxs)("div",{className:"flex gap-4 mb-6 border-b border-[#2a3142]",children:[(0,a.jsx)(d,{active:"pending"===h,onClick:()=>m("pending"),label:"En attente",count:null}),(0,a.jsx)(d,{active:"approved"===h,onClick:()=>m("approved"),label:"Valid\xe9s",count:null}),(0,a.jsx)(d,{active:"rejected"===h,onClick:()=>m("rejected"),label:"Refus\xe9s",count:null})]}),l?(0,a.jsx)("div",{className:"text-center py-12 text-gray-400",children:"Chargement..."}):0===t.length?(0,a.jsxs)("div",{className:"bg-[#1f2533] p-12 rounded-lg text-center text-gray-400 border border-[#2a3142] border-dashed",children:["pending"===h&&"Tout est propre ! Aucun commentaire en attente. ✨","approved"===h&&"Aucun commentaire valid\xe9.","rejected"===h&&"Aucun commentaire refus\xe9."]}):(0,a.jsx)("div",{className:"space-y-4",children:t.map(e=>(0,a.jsxs)("div",{className:"bg-[#1f2533] border border-[#2a3142] p-4 rounded-lg flex gap-4 transition-all hover:border-gray-600",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-[#2a3142] flex items-center justify-center text-[#ff6600] font-bold text-xs",children:e.username?e.username.charAt(0).toUpperCase():"?"}),(0,a.jsx)("span",{className:"font-bold text-white",children:e.username}),(0,a.jsxs)("span",{className:"text-gray-500 text-sm",children:["• ",(0,s.m)(new Date(e.created_at),{addSuffix:!0,locale:i.fr})]}),(0,a.jsxs)("span",{className:"text-gray-600 text-xs bg-[#0f121e] px-2 py-0.5 rounded",children:["ID: ",e.id]})]}),(0,a.jsx)("div",{className:"bg-[#0f121e] p-3 rounded border border-[#2a3142] text-gray-200 whitespace-pre-wrap",children:e.content})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 justify-center w-32",children:["pending"===h&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u,{onClick:()=>g(e.id,"approved"),color:"green",label:"Valider"}),(0,a.jsx)(u,{onClick:()=>g(e.id,"rejected"),color:"red",label:"Refuser"})]}),"approved"===h&&(0,a.jsx)(u,{onClick:()=>g(e.id,"rejected"),color:"red",label:"Refuser"}),"rejected"===h&&(0,a.jsx)(u,{onClick:()=>g(e.id,"approved"),color:"green",label:"R\xe9habiliter"})]})]},e.id))})]})}):(0,a.jsx)("div",{className:"p-8 text-white",children:"Acc\xe8s refuse."})}function d(e){let{active:t,onClick:r,label:o,count:n}=e;return(0,a.jsx)("button",{onClick:r,className:"pb-3 px-4 text-sm font-medium border-b-2 transition-colors flex items-center gap-2 ".concat(t?"border-[#ff6600] text-white":"border-transparent text-gray-400 hover:text-gray-200"),children:o})}function u(e){let{onClick:t,color:r,label:o}=e;return(0,a.jsx)("button",{onClick:t,className:"".concat("px-3 py-1.5 rounded text-xs font-bold transition-colors w-full"," ").concat("green"===r?"bg-green-600 hover:bg-green-700 text-white":"bg-red-600 hover:bg-red-700 text-white"),children:o})}},68435:(e,t,r)=>{"use strict";r.d(t,{A:()=>d,AuthProvider:()=>l});var a=r(95155),o=r(12115),n=r(80022),c=r(85534),s=r(2818);let i=(0,o.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,o.useState)(null),[d,u]=(0,o.useState)(null),[p,h]=(0,o.useState)(!0);(0,o.useEffect)(()=>{let e=localStorage.getItem("rc_token");e?(u(e),(0,c.Ni)(e).then(e=>{e?l(e):f()}).finally(()=>h(!1))):h(!1)},[]);let m=async e=>{let t=await (0,c.XL)(e);t&&t.access_token&&(localStorage.setItem("rc_token",t.access_token),u(t.access_token),l(await (0,c.Ni)(t.access_token)))},f=()=>{localStorage.removeItem("rc_token"),u(null),l(null)},g=s.env.NEXT_PUBLIC_GOOGLE_CLIENT_ID||"";g||console.error("CRITICAL: NEXT_PUBLIC_GOOGLE_CLIENT_ID is missing. Google Login will fail.");let v=async()=>{d&&l(await (0,c.Ni)(d))};return(0,a.jsx)(n.G_,{clientId:g,children:(0,a.jsx)(i.Provider,{value:{user:r,token:d,login:m,logout:f,refreshUser:v,isAuthenticated:!!r,loading:p},children:t})})}function d(){let e=(0,o.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},85534:(e,t,r)=>{"use strict";r.d(t,{$_:()=>w,CG:()=>N,Go:()=>C,Li:()=>f,Ni:()=>p,R1:()=>n,Ri:()=>s,Sb:()=>g,Sz:()=>l,T2:()=>d,TK:()=>v,UQ:()=>i,XL:()=>u,X_:()=>h,bC:()=>x,e9:()=>o,fA:()=>j,jg:()=>b,mQ:()=>_,nL:()=>m,updateProduct:()=>c,xM:()=>y});var a=r(93681);function o(){return a.H}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6?arguments[6]:void 0;try{return(await a.u.get("/products/",{params:{console:e,limit:t,genre:r,type:o,sort:n,skip:c,search:s}})).data}catch(e){return console.error("Error fetching products:",e),[]}}async function c(e,t,r){try{return(await a.u.put("/products/".concat(e),t)).data}catch(t){return console.error("Error updating product ".concat(e,":"),t),null}}async function s(e){try{return(await a.u.get("/products/search/grouped",{params:{query:e}})).data}catch(e){return console.error("Error searching products grouped:",e),{}}}async function i(e){try{let t=await a.u.get("/products/".concat(e,"/listings"),{params:{_t:new Date().getTime()}}),r="true"===t.headers["x-is-stale"];return{data:t.data,isStale:r,status:t.status}}catch(e){var t;return{data:[],isStale:!1,status:(null===(t=e.response)||void 0===t?void 0:t.status)||500}}}async function l(e){try{return(await a.u.get("/products/".concat(e,"/related"))).data}catch(e){return console.error("Error fetching related products:",e),[]}}async function d(e,t,r,o){try{return await a.u.post("/translations/",{locale:e,key:t,value:r},{headers:{"X-Admin-Key":o}}),!0}catch(e){return console.error("Failed to save translation",e),!1}}async function u(e){try{return(await a.u.post("/auth/google",{credential:e})).data}catch(e){var t,r;throw console.error("Google Login failed",e),Error((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.detail)||e.message||"Login failed")}}async function p(e){try{return(await a.u.get("/auth/me")).data}catch(e){return null}}async function h(e){try{return(await a.u.get("/collection/")).data}catch(e){return console.error("Failed to fetch collection",e),[]}}async function m(e,t,r,o,n){try{return(await a.u.post("/collection/",{product_id:t,condition:r,paid_price:n,notes:o})).data}catch(e){var c,s;throw console.error("Failed to add to collection",e),Error((null===(s=e.response)||void 0===s?void 0:null===(c=s.data)||void 0===c?void 0:c.detail)||"Failed to add to collection")}}async function f(e,t,r){try{return(await a.u.put("/collection/".concat(t),r)).data}catch(e){var o,n;throw console.error("Failed to update collection item",e),Error((null===(n=e.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.detail)||"Failed to update item")}}async function g(e,t){try{return await a.u.delete("/collection/".concat(t)),!0}catch(e){return console.error("Failed to delete item",e),!1}}async function v(e,t){try{return(await a.u.put("/auth/me",t)).data}catch(e){throw e}}async function y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;arguments.length>1&&arguments[1];try{return(await a.u.get("/products/stats/recently-scraped",{params:{limit:e}})).data}catch(e){return console.error("Failed to fetch recently scraped products",e),[]}}async function x(e){try{return(await a.u.get("/portfolio/summary")).data}catch(e){return console.error("Failed to fetch portfolio summary",e),{total_value:0,item_count:0,console_count:0,top_items:[]}}}async function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{return(await a.u.get("/portfolio/history",{params:{range_days:t}})).data}catch(e){return console.error("Failed to fetch portfolio history",e),[]}}async function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{return(await a.u.get("/portfolio/movers",{params:{days:t}})).data}catch(e){return console.error("Failed to fetch portfolio movers",e),{gainers:[],losers:[]}}}async function _(e){try{return(await a.u.get("/portfolio/debug")).data}catch(e){return console.error("Failed to fetch portfolio debug",e),{error:"Failed to fetch debug info"}}}async function j(e){try{return(await a.u.get("/portfolio/dashboard")).data}catch(e){return console.error("Failed to fetch portfolio dashboard",e),null}}async function N(e,t){let r=new FormData;r.append("file",e);try{return(await a.u.post("/import/upload",r,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(e){var o,n;throw console.error("CSV upload failed",e),Error((null===(n=e.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.detail)||"Upload failed")}}async function C(e,t){try{return(await a.u.post("/import/confirm",{items:e})).data}catch(e){var r,o;throw console.error("Bulk import failed",e),Error((null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.detail)||"Import failed")}}},91573:(e,t,r)=>{"use strict";r.d(t,{Gy:()=>n,Ss:()=>c,Tk:()=>s,av:()=>i,vr:()=>o});var a=r(93681);async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;try{return(await a.u.get("/comments/product/".concat(e),{params:{limit:t,offset:r}})).data}catch(e){return console.error(e),{total:0,comments:[]}}}async function n(e,t,r,o){return(await a.u.post("/comments/",{product_id:e,content:t,parent_id:o},r?{headers:{Authorization:"Bearer ".concat(r)}}:{})).data}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(await a.u.get("/comments/admin/all",{headers:{Authorization:"Bearer ".concat(t),"X-Admin-Key":"admin_secret_123"},params:e?{status:e}:{}})).data}async function s(e,t,r){await a.u.patch("/comments/".concat(e,"/status"),null,{headers:{Authorization:"Bearer ".concat(r),"X-Admin-Key":"admin_secret_123"},params:{status_update:t}})}async function i(e){await a.u.delete("/comments/admin/rejected",{headers:{Authorization:"Bearer ".concat(e),"X-Admin-Key":"admin_secret_123"}})}},93681:(e,t,r)=>{"use strict";r.d(t,{H:()=>c,u:()=>s});var a=r(82651),o=r(2818);let n=o.env.NEXT_PUBLIC_API_URL?o.env.NEXT_PUBLIC_API_URL:"https://retrocharting-backend.onrender.com",c="".concat(n,"/api/v1"),s=a.A.create({baseURL:c,headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{{let t=localStorage.getItem("rc_token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),s.interceptors.response.use(e=>e,e=>Promise.reject(e))}},e=>{var t=t=>e(e.s=t);e.O(0,[5714,2651,9763,8441,1517,7358],()=>t(34157)),_N_E=e.O()}]);