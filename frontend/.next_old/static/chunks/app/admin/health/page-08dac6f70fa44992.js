(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4177],{87897:(t,e,a)=>{Promise.resolve().then(a.bind(a,45418))},45418:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>d});var r=a(95155),s=a(12115),o=a(48173),n=a.n(o),c=a(85534);function i(t){let{token:e,refreshTrigger:a}=t,[o,i]=(0,s.useState)([]),[l,d]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{(async()=>{if(e){d(!0);try{let t=await (0,c.xM)(10,e);i(t)}catch(t){console.error(t)}finally{d(!1)}}})()},[e,a]),0!==o.length||l)?(0,r.jsxs)("div",{className:"bg-[#1f2533] border border-[#2a3142] rounded overflow-hidden mb-8",children:[(0,r.jsx)("div",{className:"p-4 border-b border-[#2a3142] flex justify-between items-center bg-[#2a3142]",children:(0,r.jsxs)("h3",{className:"font-bold text-white flex items-center gap-2",children:[(0,r.jsx)("span",{children:"\uD83D\uDD52"})," Recently Updated"]})}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-left",children:[(0,r.jsx)("thead",{className:"bg-[#151922] text-gray-400 text-xs uppercase",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-3",children:"Time"}),(0,r.jsx)("th",{className:"p-3",children:"ID"}),(0,r.jsx)("th",{className:"p-3",children:"Product"}),(0,r.jsx)("th",{className:"p-3",children:"Console"}),(0,r.jsx)("th",{className:"p-3 text-center",children:"Actions"})]})}),(0,r.jsxs)("tbody",{className:"divide-y divide-[#2a3142] text-sm",children:[o.map(t=>(0,r.jsxs)("tr",{className:"hover:bg-[#252b3b] transition-colors",children:[(0,r.jsx)("td",{className:"p-3 text-gray-400 font-mono text-xs",children:t.last_scraped?new Date(t.last_scraped).toLocaleTimeString():"-"}),(0,r.jsx)("td",{className:"p-3 text-gray-500",children:t.id}),(0,r.jsx)("td",{className:"p-3 font-bold text-white max-w-[200px] truncate",title:t.product_name,children:t.product_name}),(0,r.jsx)("td",{className:"p-3 text-gray-400",children:t.console_name}),(0,r.jsx)("td",{className:"p-3 text-center",children:(0,r.jsx)(n(),{href:"/admin/games/".concat(t.id,"/edit"),className:"text-[#ff6600] hover:text-white text-xs font-bold uppercase",prefetch:!1,children:"Edit"})})]},t.id)),l&&0===o.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:5,className:"p-4 text-center text-gray-500",children:"Loading..."})})]})]})})]}):null}var l=a(2818);function d(){let[t,e]=(0,s.useState)(null),[a,o]=(0,s.useState)(null),[c,d]=(0,s.useState)([]),[u,h]=(0,s.useState)(!1),[p,m]=(0,s.useState)(null),[x,g]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{let t=localStorage.getItem("rc_token");if(!t){m("No auth token found. Please log in.");return}try{let a=await fetch("".concat(l.env.NEXT_PUBLIC_API_URL,"/api/v1/products/stats/health"),{headers:{Authorization:"Bearer ".concat(t)}});a.ok?e(await a.json()):m("Failed to load stats: ".concat(a.status))}catch(t){m("Network error loading stats.")}})()},[]),(0,s.useEffect)(()=>{let t=localStorage.getItem("rc_token");if(!t)return;let e=async()=>{try{let e=await fetch("".concat(l.env.NEXT_PUBLIC_API_URL,"/api/v1/products/stats/scraper/status"),{headers:{Authorization:"Bearer ".concat(t)}});if(e.ok){let t=await e.json();g(t),"completed"===t.status&&(null==x?void 0:x.status)==="running"&&window.location.reload()}}catch(t){console.error("Status check failed")}};e();let a=setInterval(e,5e3);return()=>clearInterval(a)},[null==x?void 0:x.status]);let f=async t=>{o(t),h(!0);try{let e=localStorage.getItem("rc_token"),a=await fetch("".concat(l.env.NEXT_PUBLIC_API_URL,"/api/v1/products/incomplete?type=").concat(t,"&limit=50"),{headers:{Authorization:"Bearer ".concat(e)}});a.ok&&d(await a.json())}finally{h(!1)}},y=async()=>{try{let t=localStorage.getItem("rc_token");(await fetch("".concat(l.env.NEXT_PUBLIC_API_URL,"/api/v1/products/stats/scrape"),{method:"POST",headers:{Authorization:"Bearer ".concat(t)}})).ok&&g({status:"running",items_processed:0})}catch(t){alert("Failed to start scraper")}};if(p)return(0,r.jsx)("div",{className:"text-red-500 p-8",children:p});if(!t)return(0,r.jsx)("div",{className:"text-white p-8",children:"Loading stats..."});let v=[{id:"image",title:"Missing Images",count:t.missing_images,color:"bg-red-500",icon:"\uD83D\uDDBC️"},{id:"description",title:"Missing Descriptions",count:t.missing_descriptions,color:"bg-yellow-500",icon:"\uD83D\uDCDD"},{id:"price",title:"Missing Prices",count:t.missing_prices,color:"bg-blue-500",icon:"\uD83D\uDCB0"},{id:"details",title:"Missing Details",count:t.missing_details,color:"bg-teal-500",icon:"ℹ️"},{id:"history",title:"No Price History",count:t.missing_history,color:"bg-purple-500",icon:"\uD83D\uDCC9"}],b=(null==x?void 0:x.status)==="running";return(0,r.jsxs)("div",{className:"text-white",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-white uppercase tracking-wider",children:"Catalog Health"}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(null==x?void 0:x.status)==="error"&&(0,r.jsxs)("div",{className:"bg-red-500/20 border border-red-500 text-red-200 px-4 py-2 rounded mb-4 text-xs font-mono",children:[(0,r.jsx)("strong",{children:"Last Error:"})," ",x.error_message]}),b?(0,r.jsxs)("div",{className:"flex items-center gap-3 bg-[#2a3142] px-4 py-2 rounded animate-pulse border border-[#ff6600]",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-[#ff6600] rounded-full"}),(0,r.jsx)("span",{className:"text-white font-bold text-sm uppercase",children:"Processing..."}),(0,r.jsx)("span",{className:"text-[#ff6600] font-mono font-bold text-lg",children:x.items_processed})]}):(0,r.jsx)("div",{className:"text-right",children:t&&t.last_activity?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"text-xs text-gray-400",children:"Last Scraper Run"}),(0,r.jsx)("p",{className:"text-sm font-bold text-[#00ff00]",children:new Date(t.last_activity).toLocaleString()}),new Date().getTime()-new Date(t.last_activity).getTime()>864e5&&(0,r.jsx)("p",{className:"text-xs text-red-500 font-bold animate-pulse",children:"inactive > 24h"})]}):(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"No activity recorded"})}),(0,r.jsx)("button",{onClick:y,disabled:b,className:"px-4 py-2 rounded font-bold text-sm uppercase tracking-wide transition-colors ".concat(b?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-[#ff6600] hover:bg-[#ff8533] text-white"),children:b?"Scraper Running...":"▶ Run Auto-Scraper"}),(0,r.jsx)("button",{onClick:async()=>{if(!confirm("Start Maintenance: Fix Inflated Prices?"))return;let t=localStorage.getItem("rc_token");try{let e=await fetch("".concat(l.env.NEXT_PUBLIC_API_URL,"/api/v1/products/maintenance/fix-prices"),{method:"POST",headers:{Authorization:"Bearer ".concat(t)}}),a=await e.json();alert(a.message||"Maintenance completed.")}catch(t){alert("Failed to run maintenance.")}},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-bold text-sm uppercase tracking-wide transition-colors ml-4",children:"\uD83D\uDD27 Fix Prices"})]})]}),(0,r.jsx)(i,{token:localStorage.getItem("rc_token")||"",refreshTrigger:(null==x?void 0:x.items_processed)||0}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8 mt-8",children:v.map(e=>{let s=(e.count/t.total_products*100).toFixed(1),o=a===e.id;return(0,r.jsxs)("div",{onClick:()=>f(e.id),className:"p-6 rounded border cursor-pointer transition-all ".concat(o?"border-white bg-[#2a3142]":"border-[#2a3142] bg-[#1f2533] hover:border-gray-500"),children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,r.jsx)("span",{className:"text-3xl",children:e.icon}),(0,r.jsxs)("span",{className:"text-xs font-bold px-2 py-1 rounded text-white ".concat(e.color),children:[s,"%"]})]}),(0,r.jsx)("h3",{className:"text-gray-400 uppercase text-xs font-bold tracking-wider mb-1",children:e.title}),(0,r.jsx)("p",{className:"text-3xl font-bold text-white",children:e.count.toLocaleString()}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"items needing attention"})]},e.id)})}),a&&(0,r.jsxs)("div",{className:"bg-[#1f2533] border border-[#2a3142] rounded overflow-hidden",children:[(0,r.jsx)("div",{className:"p-4 border-b border-[#2a3142] flex justify-between items-center bg-[#2a3142]",children:(0,r.jsxs)("h3",{className:"font-bold text-white",children:["Items with Missing ",a.charAt(0).toUpperCase()+a.slice(1)," (First 50)"]})}),u?(0,r.jsx)("div",{className:"p-8 text-center text-gray-400",children:"Loading details..."}):(0,r.jsxs)("table",{className:"w-full text-left",children:[(0,r.jsx)("thead",{className:"bg-[#151922] text-gray-400 text-xs uppercase",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-4",children:"ID"}),(0,r.jsx)("th",{className:"p-4",children:"Name"}),(0,r.jsx)("th",{className:"p-4",children:"Console"}),(0,r.jsx)("th",{className:"p-4 text-center",children:"Action"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-[#2a3142] text-sm",children:c.map(t=>(0,r.jsxs)("tr",{className:"hover:bg-[#252b3b]",children:[(0,r.jsx)("td",{className:"p-4 text-gray-500",children:t.id}),(0,r.jsx)("td",{className:"p-4 font-bold text-white",children:t.product_name}),(0,r.jsx)("td",{className:"p-4 text-gray-300",children:t.console_name}),(0,r.jsx)("td",{className:"p-4 text-center",children:(0,r.jsxs)("div",{className:"flex justify-center gap-3",children:[(0,r.jsx)(n(),{href:"/admin/games/".concat(t.id,"/edit"),className:"text-gray-400 hover:text-[#ff6600] transition-colors",title:"Edit Details",prefetch:!1,children:"✎"}),(0,r.jsx)(n(),{href:"/admin/games/".concat(t.id,"/listings"),className:"text-blue-400 hover:text-white",title:"Manage Listings",prefetch:!1,children:"Listings"})]})})]},t.id))})]})]})]})}},85534:(t,e,a)=>{"use strict";a.d(e,{$_:()=>j,CG:()=>_,Go:()=>L,Li:()=>x,Ni:()=>h,R1:()=>o,Ri:()=>c,Sb:()=>g,Sz:()=>l,T2:()=>d,TK:()=>f,UQ:()=>i,XL:()=>u,X_:()=>p,bC:()=>v,e9:()=>s,fA:()=>N,jg:()=>b,mQ:()=>w,nL:()=>m,updateProduct:()=>n,xM:()=>y});var r=a(93681);function s(){return r.H}async function o(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,a=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6?arguments[6]:void 0;try{return(await r.u.get("/products/",{params:{console:t,limit:e,genre:a,type:s,sort:o,skip:n,search:c}})).data}catch(t){return console.error("Error fetching products:",t),[]}}async function n(t,e,a){try{return(await r.u.put("/products/".concat(t),e)).data}catch(e){return console.error("Error updating product ".concat(t,":"),e),null}}async function c(t){try{return(await r.u.get("/products/search/grouped",{params:{query:t}})).data}catch(t){return console.error("Error searching products grouped:",t),{}}}async function i(t){try{let e=await r.u.get("/products/".concat(t,"/listings"),{params:{_t:new Date().getTime()}}),a="true"===e.headers["x-is-stale"];return{data:e.data,isStale:a,status:e.status}}catch(t){var e;return{data:[],isStale:!1,status:(null===(e=t.response)||void 0===e?void 0:e.status)||500}}}async function l(t){try{return(await r.u.get("/products/".concat(t,"/related"))).data}catch(t){return console.error("Error fetching related products:",t),[]}}async function d(t,e,a,s){try{return await r.u.post("/translations/",{locale:t,key:e,value:a},{headers:{"X-Admin-Key":s}}),!0}catch(t){return console.error("Failed to save translation",t),!1}}async function u(t){try{return(await r.u.post("/auth/google",{credential:t})).data}catch(t){var e,a;throw console.error("Google Login failed",t),Error((null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.detail)||t.message||"Login failed")}}async function h(t){try{return(await r.u.get("/auth/me")).data}catch(t){return null}}async function p(t){try{return(await r.u.get("/collection/")).data}catch(t){return console.error("Failed to fetch collection",t),[]}}async function m(t,e,a,s,o){try{return(await r.u.post("/collection/",{product_id:e,condition:a,paid_price:o,notes:s})).data}catch(t){var n,c;throw console.error("Failed to add to collection",t),Error((null===(c=t.response)||void 0===c?void 0:null===(n=c.data)||void 0===n?void 0:n.detail)||"Failed to add to collection")}}async function x(t,e,a){try{return(await r.u.put("/collection/".concat(e),a)).data}catch(t){var s,o;throw console.error("Failed to update collection item",t),Error((null===(o=t.response)||void 0===o?void 0:null===(s=o.data)||void 0===s?void 0:s.detail)||"Failed to update item")}}async function g(t,e){try{return await r.u.delete("/collection/".concat(e)),!0}catch(t){return console.error("Failed to delete item",t),!1}}async function f(t,e){try{return(await r.u.put("/auth/me",e)).data}catch(t){throw t}}async function y(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;arguments.length>1&&arguments[1];try{return(await r.u.get("/products/stats/recently-scraped",{params:{limit:t}})).data}catch(t){return console.error("Failed to fetch recently scraped products",t),[]}}async function v(t){try{return(await r.u.get("/portfolio/summary")).data}catch(t){return console.error("Failed to fetch portfolio summary",t),{total_value:0,item_count:0,console_count:0,top_items:[]}}}async function b(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{return(await r.u.get("/portfolio/history",{params:{range_days:e}})).data}catch(t){return console.error("Failed to fetch portfolio history",t),[]}}async function j(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{return(await r.u.get("/portfolio/movers",{params:{days:e}})).data}catch(t){return console.error("Failed to fetch portfolio movers",t),{gainers:[],losers:[]}}}async function w(t){try{return(await r.u.get("/portfolio/debug")).data}catch(t){return console.error("Failed to fetch portfolio debug",t),{error:"Failed to fetch debug info"}}}async function N(t){try{return(await r.u.get("/portfolio/dashboard")).data}catch(t){return console.error("Failed to fetch portfolio dashboard",t),null}}async function _(t,e){let a=new FormData;a.append("file",t);try{return(await r.u.post("/import/upload",a,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(t){var s,o;throw console.error("CSV upload failed",t),Error((null===(o=t.response)||void 0===o?void 0:null===(s=o.data)||void 0===s?void 0:s.detail)||"Upload failed")}}async function L(t,e){try{return(await r.u.post("/import/confirm",{items:t})).data}catch(t){var a,s;throw console.error("Bulk import failed",t),Error((null===(s=t.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.detail)||"Import failed")}}},93681:(t,e,a)=>{"use strict";a.d(e,{H:()=>n,u:()=>c});var r=a(82651),s=a(2818);let o=s.env.NEXT_PUBLIC_API_URL?s.env.NEXT_PUBLIC_API_URL:"https://retrocharting-backend.onrender.com",n="".concat(o,"/api/v1"),c=r.A.create({baseURL:n,headers:{"Content-Type":"application/json"}});c.interceptors.request.use(t=>{{let e=localStorage.getItem("rc_token");e&&(t.headers.Authorization="Bearer ".concat(e))}return t},t=>Promise.reject(t)),c.interceptors.response.use(t=>t,t=>Promise.reject(t))}},t=>{var e=e=>t(t.s=e);t.O(0,[5714,2651,8173,8441,1517,7358],()=>e(87897)),_N_E=t.O()}]);